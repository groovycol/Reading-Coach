{% extends 'base.html' %}
{% block content %}

<script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/1.0.2/Chart.js"> </script>
<script src="https://code.jquery.com/jquery.js"></script>
    <h1> Reading Progress</h1>
    <h3><label>Reader:</label></h3>
    {% if coach.readers|length > 1 %}
        <select name="reader_id" id="reader_id">
        {% for reader in coach.readers %}
            <option value="{{ reader.reader_id }}">{{ reader.first_name }}</option>
        {% endfor %}
        </select>
    {% else %}
        {% for reader in coach.readers %}
            <h3>{{ reader.first_name }}</h3>
            <input type="hidden" id="reader_id" name="reader_id" value="{{reader.reader_id}}">
        {% endfor %}
    {% endif %}
        <div class="reader-progress-chart">
        <div id="canvas"></div>
        <button id="time_period" value="week">Show all</button>
        <script>
            // Initialize some chart variables
            var canvas_tag = '<canvas id="barChart" width="1200" height="600"></canvas>'

            var options = { responsive: true, maintainAspectRatio: true};

            // initial chart display last 7 days
            function draw_chart() { 
                $("#barChart").remove()
                $("#canvas").append(canvas_tag)
                var ctx_bar = $("#barChart").get(0).getContext("2d");
                $.get("/reader-progress.json", {"reader_id": $("#reader_id").val(), "time_period": $('#time_period').val() }, function (data) {
                        var myBarChart = new Chart(ctx_bar).Bar(data, options);
            });}

            // function toggles chart display and button text
            function toggleDataDisplay(evt) {
                if ($('#time_period').text() === "Show all"){
                    $('#time_period').text("Show this week");
                    $('#time_period').val("all");
                } else {
                    $('#time_period').text("Show all");
                    $('#time_period').val("week");
                }

                //redraw the chart
                draw_chart();
            }

            //initial chart display
            draw_chart();

            // evt handler for dropdown select of reader name
            $('#reader_id').change(draw_chart)

            // evt handler for button click to toggle chart data display
            $('#time_period').click(toggleDataDisplay)

        </script>
{% endblock %}